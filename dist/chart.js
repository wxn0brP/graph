import{a as C,b as x}from"./index-8z2a50b7.js";var m,p=[],r={},f=[],l=document.querySelector("#status"),S=document.querySelector("#controls"),h=document.querySelector("#packagesList"),L=document.querySelector("#selectedCount"),E=["db","db-core","vql","vql-client","falcon-frame","flanker-ui"],w=new URLSearchParams(window.location.search);if(w.has("p"))E=w.get("p").split(",");async function v(){try{l.textContent="Searching for packages...";let n=await x();if(n.length===0){l.textContent="No packages found in scope @wxn0brp.";return}l.textContent=`Found ${n.length} packages. Fetching download stats...`;let a=new Date,d=new Date;d.setDate(a.getDate()-60);let i=`${d.toISOString().split("T")[0]}:${a.toISOString().split("T")[0]}`,y=new Set;for(let e of n)try{let t=await C(e,async(c,s)=>{let u=await fetch(`https://api.npmjs.org/downloads/range/${c}/${encodeURIComponent(s)}`);if(!u.ok)return{};return await u.json()},i,e);if(!t||!t.downloads||!Array.isArray(t.downloads))continue;let o={};if(t.downloads.forEach((c)=>{let s=new Date(c.day),u=new Date(s);u.setDate(s.getDate()-s.getDay()+1);let g=u.toISOString().split("T")[0];o[g]=(o[g]||0)+c.downloads,y.add(g)}),Object.keys(o).length>0){let c=e.replace("@wxn0brp/","");p.push(c),r[c]={weekly:o,enabled:E.includes(c)}}}catch(t){console.warn(`Error for ${e}:`,t)}if(p.length===0){l.textContent="No download data available for any package.";return}f.push(...Array.from(y).sort());let b=document.createDocumentFragment();p.forEach((e)=>{let t=document.createElement("div");t.className="package-item";let o=document.createElement("input");o.type="checkbox",o.id="cb_"+e,o.checked=r[e].enabled,o.dataset.pkg=e;let c=document.createElement("label");c.htmlFor="cb_"+e,c.textContent=e,t.appendChild(o),t.appendChild(c),b.appendChild(t)}),h.innerHTML="",h.appendChild(b),S.style.display="block",k(),T(),document.querySelector("#searchBox").addEventListener("input",(e)=>{let t=e.target.value.toLowerCase();document.querySelectorAll(".package-item").forEach((o)=>{let s=o.querySelector("label").textContent.toLowerCase();o.style.display=s.includes(t)?"flex":"none"})}),h.addEventListener("change",(e)=>{if(e.target.type==="checkbox"){let t=e.target.dataset.pkg;r[t].enabled=e.target.checked,k(),M()}}),l.textContent="Ready! Use checkboxes to show/hide packages.",l.style.color="#66ff99"}catch(n){console.error(n),l.textContent="Error: "+n.message}}function k(){let n=p.filter((a)=>r[a].enabled).length;L.textContent=n.toString()}function T(){let n=document.querySelector("#downloadsChart").getContext("2d");m=new Chart(n,H())}function M(){m.data.datasets=D(),m.update()}function D(){let n=p.filter((a)=>r[a].enabled);return n.forEach((a,d)=>{let i=d*360/n.length;r[a].color=`hsl(${i}, 70%, 50%)`}),n.map((a)=>{let d=f.map((i)=>r[a].weekly[i]||0);return{label:a,data:d,borderColor:r[a].color,backgroundColor:r[a].color,fill:!1,tension:0.3,pointRadius:3,borderWidth:2}})}function H(){return{type:"line",data:{labels:f,datasets:D()},options:{responsive:!0,plugins:{title:{display:!0,text:"Weekly Downloads of @wxn0brp/* Packages - Line Chart",color:"#ffffff"},tooltip:{mode:"index",intersect:!1},legend:{position:"right",labels:{color:"#e0e0e0",boxWidth:12,padding:10}}},scales:{x:{title:{display:!0,text:"Week (starting Monday)",color:"#cccccc"},ticks:{color:"#cccccc"},grid:{color:"#444444"}},y:{title:{display:!0,text:"Number of Downloads",color:"#cccccc"},ticks:{color:"#cccccc"},grid:{color:"#444444"},beginAtZero:!0}}}}}v();

//# debugId=EA99C51E35519E6F64756E2164756E21
//# sourceMappingURL=chart.js.map
