import{a as L,b as v}from"./index-8z2a50b7.js";var h,f=[],c={},u=[],d=document.querySelector("#status"),I=document.querySelector("#controls"),w=document.querySelector("#packagesList"),P=document.querySelector("#selectedCount"),m=["db","db-core","vql","vql-client","falcon-frame","flanker-ui"],E=new URLSearchParams(window.location.search);if(E.has("p"))m=E.get("p").split(",");async function R(){try{d.textContent="Searching for packages...";let t=await v();if(t.length===0){d.textContent="No packages found in scope @wxn0brp.";return}d.textContent=`Found ${t.length} packages. Initializing...`,t.forEach((e)=>{let a=e.replace("@wxn0brp/","");f.push(a),c[a]={weekly:{},enabled:m.includes(a)}}),f.sort();let o=document.createDocumentFragment();f.forEach((e)=>{let a=document.createElement("div");a.className="package-item";let n=document.createElement("input");n.type="checkbox",n.id="cb_"+e,n.checked=c[e].enabled,n.dataset.pkg=e;let r=document.createElement("label");r.htmlFor="cb_"+e,r.textContent=e,a.appendChild(n),a.appendChild(r),o.appendChild(a)}),w.innerHTML="",w.appendChild(o),I.style.display="block",S(),$(),document.querySelector("#searchBox").addEventListener("input",(e)=>{let a=e.target.value.toLowerCase();document.querySelectorAll(".package-item").forEach((n)=>{let y=n.querySelector("label").textContent.toLowerCase();n.style.display=y.includes(a)?"flex":"none"})}),w.addEventListener("change",(e)=>{if(e.target.type==="checkbox"){let a=e.target.dataset.pkg;c[a].enabled=e.target.checked,S(),D()}}),d.textContent="Fetching download stats...";let g=new Date,p=new Date;p.setDate(g.getDate()-60);let M=`${p.toISOString().split("T")[0]}:${g.toISOString().split("T")[0]}`,C=new Set,x=async(e,a)=>{try{let n=await L(e,async(s,l)=>{let i=await fetch(`https://api.npmjs.org/downloads/range/${s}/${encodeURIComponent(l)}`);if(!i.ok)return{};return await i.json()},M,e);if(!n||!n.downloads||!Array.isArray(n.downloads))return;let r={};n.downloads.forEach((s)=>{let l=new Date(s.day),i=new Date(l);i.setDate(l.getDate()-l.getDay()+1);let b=i.toISOString().split("T")[0];r[b]=(r[b]||0)+s.downloads,C.add(b)});let y=k(e);if(Object.keys(r).length>0){c[y].weekly=r;let s=Array.from(C).sort();if(s.length>u.length||s.some((l,i)=>l!==u[i]))u.length=0,u.push(...s);if(a)D()}}catch(n){console.warn(`Error for ${e}:`,n)}},H=t.filter((e)=>m.includes(k(e))),q=t.filter((e)=>!m.includes(k(e)));await Promise.all(H.map((e)=>x(e,!0))),d.textContent="Ready! Use checkboxes to show/hide packages.",d.style.color="#66ff99";for(let e of q)await x(e,!1)}catch(t){console.error(t),d.textContent="Error: "+t.message}}function S(){let t=f.filter((o)=>c[o].enabled).length;P.textContent=t.toString()}function $(){let t=document.querySelector("#downloadsChart").getContext("2d");h=new Chart(t,W())}function D(){if(!h)return;h.data.labels=u,h.data.datasets=T(),h.update()}function k(t){return t.replace("@wxn0brp/","")}function T(){let t=f.filter((o)=>c[o].enabled);return t.forEach((o,g)=>{let p=g*360/t.length;c[o].color=`hsl(${p}, 70%, 50%)`}),t.map((o)=>{let g=u.map((p)=>c[o].weekly[p]||0);return{label:o,data:g,borderColor:c[o].color,backgroundColor:c[o].color,fill:!1,tension:0.3,pointRadius:3,borderWidth:2}})}function W(){return{type:"line",data:{labels:u,datasets:T()},options:{responsive:!0,plugins:{title:{display:!0,text:"Weekly Downloads of @wxn0brp/* Packages - Line Chart",color:"#ffffff"},tooltip:{mode:"index",intersect:!1},legend:{position:"right",labels:{color:"#e0e0e0",boxWidth:12,padding:10}}},scales:{x:{title:{display:!0,text:"Week (starting Monday)",color:"#cccccc"},ticks:{color:"#cccccc"},grid:{color:"#444444"}},y:{title:{display:!0,text:"Number of Downloads",color:"#cccccc"},ticks:{color:"#cccccc"},grid:{color:"#444444"},beginAtZero:!0}}}}}R();

//# debugId=28DF09FC554CDC5E64756E2164756E21
//# sourceMappingURL=chart.js.map
