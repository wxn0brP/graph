{
  "version": 3,
  "sources": ["../../src/chart.ts"],
  "sourcesContent": [
    "import { getCache, searchPackages } from \"./api\";\n\nlet chart: any;\ndeclare const Chart: any;\n\nconst allPackages: string[] = [];\nconst packageData: Record<\n    string,\n    {\n        weekly: Record<string, number>;\n        enabled: boolean;\n        color?: string;\n    }\n> = {}\nconst allWeeks: string[] = [];\n\nconst statusEl = document.querySelector<HTMLDivElement>(\"#status\");\nconst controlsEl = document.querySelector<HTMLDivElement>(\"#controls\");\nconst packagesListEl = document.querySelector<HTMLDivElement>(\"#packagesList\");\nconst selectedCountEl = document.querySelector<HTMLDivElement>(\"#selectedCount\");\n\nlet preEnabled = [\n    \"db\",\n    \"db-core\",\n    \"vql\",\n    \"vql-client\",\n    \"falcon-frame\",\n    \"flanker-ui\",\n]\nconst params = new URLSearchParams(window.location.search);\nif (params.has(\"p\")) preEnabled = params.get(\"pre\")!.split(\",\");\n\nasync function loadData() {\n    try {\n        statusEl.textContent = \"Searching for packages...\";\n        const packages = await searchPackages();\n\n        if (packages.length === 0) {\n            statusEl.textContent = \"No packages found in scope @wxn0brp.\";\n            return;\n        }\n\n        statusEl.textContent = `Found ${packages.length} packages. Fetching download stats...`;\n\n        const endDate = new Date();\n        const startDate = new Date();\n        startDate.setDate(endDate.getDate() - 60);\n        const range = `${startDate.toISOString().split(\"T\")[0]}:${endDate.toISOString().split(\"T\")[0]}`;\n\n        const weeksSet = new Set<string>();\n\n        for (const pkg of packages) {\n            try {\n                const data = await getCache(pkg, async (range, pkg) => {\n                    const resp = await fetch(`https://api.npmjs.org/downloads/range/${range}/${encodeURIComponent(pkg)}`);\n                    if (!resp.ok) return {};\n                    const data = await resp.json();\n                    return data;\n                }, range, pkg);\n\n                if (!data || !data.downloads || !Array.isArray(data.downloads)) continue;\n\n                const weekly: Record<string, number> = {};\n\n                data.downloads.forEach((point: { day: string, downloads: number }) => {\n                    const date = new Date(point.day);\n                    const weekStart = new Date(date);\n                    weekStart.setDate(date.getDate() - date.getDay() + 1); // Monday start\n                    const weekKey = weekStart.toISOString().split(\"T\")[0];\n                    weekly[weekKey] = (weekly[weekKey] || 0) + point.downloads;\n                    weeksSet.add(weekKey);\n                });\n\n                if (Object.keys(weekly).length > 0) {\n                    const name = pkg.replace(\"@wxn0brp/\", \"\");\n                    allPackages.push(name);\n                    packageData[name] = { weekly, enabled: preEnabled.includes(name) };\n                }\n            } catch (err) {\n                console.warn(`Error for ${pkg}:`, err);\n            }\n        }\n\n        if (allPackages.length === 0) {\n            statusEl.textContent = \"No download data available for any package.\";\n            return;\n        }\n\n        allWeeks.push(...Array.from(weeksSet).sort());\n\n        const fragment = document.createDocumentFragment();\n        allPackages.forEach(pkg => {\n            const div = document.createElement(\"div\");\n            div.className = \"package-item\";\n\n            const checkbox = document.createElement(\"input\");\n            checkbox.type = \"checkbox\";\n            checkbox.id = \"cb_\" + pkg;\n            checkbox.checked = packageData[pkg].enabled;\n            checkbox.dataset.pkg = pkg;\n\n            const label = document.createElement(\"label\");\n            label.htmlFor = \"cb_\" + pkg;\n            label.textContent = pkg;\n\n            div.appendChild(checkbox);\n            div.appendChild(label);\n            fragment.appendChild(div);\n        });\n        packagesListEl.innerHTML = \"\";\n        packagesListEl.appendChild(fragment);\n        controlsEl.style.display = \"block\";\n\n        updateSelectedCount();\n        createChart();\n\n        document.querySelector<HTMLInputElement>(\"#searchBox\").addEventListener(\"input\", e => {\n            const term = (e.target as HTMLInputElement).value.toLowerCase();\n            document.querySelectorAll(\".package-item\").forEach(item => {\n                const label = item.querySelector(\"label\")!;\n                const text = label.textContent!.toLowerCase();\n                (item as HTMLElement).style.display = text.includes(term) ? \"flex\" : \"none\";\n            });\n        });\n\n        packagesListEl.addEventListener(\"change\", e => {\n            if ((e.target as HTMLInputElement).type === \"checkbox\") {\n                const pkg = (e.target as HTMLInputElement).dataset.pkg!;\n                packageData[pkg].enabled = (e.target as HTMLInputElement).checked;\n                updateSelectedCount();\n                updateChart();\n            }\n        });\n\n        statusEl.textContent = \"Ready! Use checkboxes to show/hide packages.\";\n        statusEl.style.color = \"#66ff99\";\n\n    } catch (err: any) {\n        console.error(err);\n        statusEl.textContent = \"Error: \" + err.message;\n    }\n}\n\nfunction updateSelectedCount() {\n    const count = allPackages.filter(pkg => packageData[pkg].enabled).length;\n    selectedCountEl.textContent = count.toString();\n}\n\nfunction createChart() {\n    const ctx = document.querySelector<HTMLCanvasElement>(\"#downloadsChart\").getContext(\"2d\")!;\n    chart = new Chart(ctx, getChartConfig());\n}\n\nfunction updateChart() {\n    chart.data.datasets = getDatasets();\n    chart.update();\n}\n\nfunction getDatasets() {\n    const visiblePackages = allPackages.filter(pkg => packageData[pkg].enabled);\n\n    visiblePackages.forEach((pkg, index) => {\n        const hue = (index * 360 / visiblePackages.length);\n        packageData[pkg].color = `hsl(${hue}, 70%, 50%)`;\n    });\n\n    return visiblePackages.map(pkg => {\n        const data = allWeeks.map(week => packageData[pkg].weekly[week] || 0);\n        return {\n            label: pkg,\n            data: data,\n            borderColor: packageData[pkg].color,\n            backgroundColor: packageData[pkg].color,\n            fill: false,\n            tension: 0.3,\n            pointRadius: 3,\n            borderWidth: 2\n        };\n    });\n}\n\nfunction getChartConfig() {\n    return {\n        type: \"line\",\n        data: {\n            labels: allWeeks,\n            datasets: getDatasets()\n        },\n        options: {\n            responsive: true,\n            plugins: {\n                title: {\n                    display: true,\n                    text: \"Weekly Downloads of @wxn0brp/* Packages - Line Chart\",\n                    color: \"#ffffff\"\n                },\n                tooltip: {\n                    mode: \"index\",\n                    intersect: false\n                },\n                legend: {\n                    position: \"right\",\n                    labels: {\n                        color: \"#e0e0e0\",\n                        boxWidth: 12,\n                        padding: 10\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    title: { display: true, text: \"Week (starting Monday)\", color: \"#cccccc\" },\n                    ticks: { color: \"#cccccc\" },\n                    grid: { color: \"#444444\" }\n                },\n                y: {\n                    title: { display: true, text: \"Number of Downloads\", color: \"#cccccc\" },\n                    ticks: { color: \"#cccccc\" },\n                    grid: { color: \"#444444\" },\n                    beginAtZero: true\n                }\n            }\n        }\n    };\n}\n\nloadData();\n"
  ],
  "mappings": "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",
  "debugId": "CC5B8E2F49A9791F64756E2164756E21",
  "names": []
}